<div class="places-search-container">
  <div class="places-search-card" [class.expanded]="showFullPanel">
    <div class="card-header" (click)="togglePanel()">
      <h3>
        <i class="fas fa-map-marker-alt"></i>
        Points d'intérêt
      </h3>
      <button class="toggle-button">
        <i class="fas" [ngClass]="showFullPanel ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
      </button>
    </div>

    <div class="card-content" *ngIf="showFullPanel">
      <div class="search-controls">
        <div class="search-wrapper">
          <div class="search-input">
            <i class="fas fa-search search-icon"></i>
            <input type="text" [(ngModel)]="searchQuery" placeholder="Rechercher un lieu..."
              (keyup)="onSearchKeyUp($event)" (focus)="showSuggestions = true">
            <button class="clear-button" *ngIf="searchQuery" (click)="clearSearch()">
              <i class="fas fa-times"></i>
            </button>
          </div>

          <ng-container *ngIf="showSuggestions && suggestions.length > 0">
            <div class="suggestion-item" *ngFor="let suggestion of suggestions" (click)="selectSuggestion(suggestion)"
              [class.active]="suggestion === activeSuggestion">
              <i class="fas fa-map-marker-alt suggestion-icon"></i>
              <div class="suggestion-content">
                <div class="suggestion-name">{{ suggestion.name }}</div>
                <div class="suggestion-description" *ngIf="suggestion.description">{{ suggestion.description }}</div>
              </div>
            </div>
          </ng-container>
        </div>

        <div class="filter-controls">
          <div class="search-option">
            <label class="checkbox-container">
              <input type="checkbox" [(ngModel)]="autoSearch" (change)="onAutoSearchChange()">
              <span class="checkmark"></span>
              <span class="label-text">Recherche automatique</span>
            </label>
          </div>

          <div class="radius-control" *ngIf="autoSearch">
            <label class="radius-label">Rayon: {{ searchRadius }}m</label>
            <div class="slider-container">
              <input type="range" min="100" max="5000" step="100" [(ngModel)]="searchRadius" (change)="onRadiusChange()"
                class="slider">
            </div>
          </div>
        </div>
      </div>

      <!-- Indicateur de chargement -->
      <div class="loading-indicator" *ngIf="loading">
        <div class="spinner">
          <i class="fas fa-circle-notch fa-spin"></i>
        </div>
        <p>Recherche en cours...</p>
      </div>

      <!-- Message pour aucun résultat -->
      <div class="no-results-message" *ngIf="searched && places.length === 0 && !loading">
        <div class="message-content">
          <i class="fas fa-search"></i>
          <p>Aucun point d'intérêt trouvé</p>
        </div>
      </div>

      <!-- Message d'erreur -->
      <div class="error-message" *ngIf="errorMessage && !loading">
        <div class="message-content">
          <i class="fas fa-exclamation-triangle"></i>
          <p>{{ errorMessage }}</p>
          <button class="debug-button" (click)="toggleDebug()">Infos de débogage</button>
        </div>
      </div>

      <!-- Informations de débogage -->
      <div *ngIf="debugInfo" class="debug-info">
        <div class="debug-header">
          <h4>Informations de débogage</h4>
          <button class="close-button" (click)="toggleDebug()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <p><strong>Mode de carte:</strong> {{ providerType }}</p>
        <p><strong>Token Mapbox:</strong> {{ mapboxTokenAvailable ? "Disponible" : "Non disponible" }}</p>
      </div>

      <!-- Liste des lieux trouvés -->
      <div class="places-results" *ngIf="places.length > 0 && !loading">
        <div class="place-item" *ngFor="let place of places" (click)="selectPlace(place)"
          [class.selected]="selectedPlace === place">
          <div class="place-icon">
            <i class="fas" [ngClass]="getIconClass(place.type)"></i>
          </div>
          <div class="place-info">
            <div class="place-name">{{ place.name }}</div>
            <div class="place-details">
              <div class="place-address" *ngIf="place.address">
                <i class="fas fa-map-signs"></i> {{ place.address }}
              </div>
              <div class="place-rating" *ngIf="place.rating">
                <i class="fas fa-star"></i> {{ place.rating }}
              </div>
              <div class="place-plus-code" *ngIf="place.plusCode">
                <i class="fas fa-location-arrow"></i> {{ place.plusCode }}
              </div>
            </div>
          </div>
          <button class="mark-zone-button"
            *ngIf="selectedPlace === place && selectedPlace.lat !== 0 && selectedPlace.lng !== 0"
            (click)="markZone(place, $event)">
            <i class="fas fa-map-marker-alt"></i>
          </button>
        </div>
      </div>

      <!-- Zone marquée -->
      <div class="marked-zone" *ngIf="markedZone">
        <div class="marked-zone-header">
          <h4>Zone marquée</h4>
          <button class="close-button" (click)="clearMarkedZone()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        <div class="marked-zone-content">
          <div class="marked-zone-name">
            <i class="fas fa-map-marker-alt"></i> {{ markedZone.name }}
          </div>
          <div class="marked-zone-coords">
            <i class="fas fa-crosshairs"></i> {{ markedZone.lat.toFixed(6) }}, {{ markedZone.lng.toFixed(6) }}
          </div>
          <div class="marked-zone-plus-code">
            <i class="fas fa-location-arrow"></i> {{ markedZone.plusCode }}
          </div>
        </div>
      </div>
    </div>
  </div>
</div>